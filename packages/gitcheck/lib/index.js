#! /usr/bin/env node
import e from"picocolors";import o from"path";import{glob as t}from"glob";import{simpleGit as i}from"simple-git";import l from"ora";import n from"cac";async function r(n){n=n||process.cwd();const r=l("åˆ†æç›®å½•ä¸­").start(),a=await t("**/.git/",{cwd:n,ignore:"node_modules/**"});if(0==a.length)return void r.succeed(e.green(`åˆ†æå®Œæˆ! æœªå‘ç°gité¡¹ç›®(${e.italic(n)})`));const c=a.map((async e=>{const t=o.resolve(n,e,".."),l=await async function(e){const o=i(e,{binary:"git"}),t=await o.status().then((o=>({ahead:o.ahead,gitDir:e,unsafeDir:!1,staged:o.staged.length>0,not_added:o.not_added.length>0,modified:o.modified.length>0}))).catch((o=>({gitDir:e,unsafeDir:o.message.includes("config --global --add safe.directory")})));return t}(t);return l}));Promise.all(c).then((o=>{const t=o.filter((e=>e.unsafeDir)).map((e=>e.gitDir)),i=o.filter((e=>e.staged)).map((e=>e.gitDir)),l=o.filter((e=>e.not_added&&!e.staged)).map((e=>e.gitDir)),a=o.filter((e=>e.ahead)).map((e=>e.gitDir));r.succeed(e.green(`${e.bold("ç›®å½•åˆ†æå®Œæˆ")} (${e.italic(n)})`)),t.length>0&&(console.log(e.bgBlue(`ğŸš€ insecure directoryï¼ˆ${t.length}ï¼‰: `)),t.map((o=>console.log(e.italic(e.red(o)))))),l.length>0&&(console.log(e.bgBlue(`ğŸš€ add âŒ commit âŒ push âŒ ï¼ˆ${l.length}ï¼‰: `)),l.map((o=>console.log(e.italic(e.yellow(o)))))),i.length>0&&(console.log(e.bgBlue(`ğŸš€ add âœ… commit âŒ push âŒ ï¼ˆ${i.length}ï¼‰ï¼š`)),i.map((o=>console.log(e.italic(e.yellow(o)))))),a.length>0&&(console.log(e.bgBlue(`ğŸš€ add âœ… commit âœ… push âŒï¼ˆ${a.length}ï¼‰: `)),a.map((o=>console.log(e.italic(e.yellow(o)))))),0===t.length&&0===l.length&&0===i.length&&0===a.length&&console.log(e.green("âœ… å·²å…¨éƒ¨æäº¤ä¸”æ¨é€"))})).catch((o=>{r.fail(e.red("åˆ†æå¤±è´¥")),console.log(e.red(o))}))}const a=n();a.help(),a.version("0.0.9-beta.1"),a.option("-d ,--dir <dir>","Parse folder",{default:"."}),a.command("rm <dir>","Remove a dir").option("-r, --recursive","Remove recursively").action(((e,o)=>{console.log("options: ",o),console.log("remove "+e)})),a.command("[...files]","files").action(((e,t)=>{r(o.resolve(t.dir))})),a.parse();
